<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>General Ledger</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 30px; }
    nav a {
      margin-right: 20px;
      text-decoration: none;
      color: #0366d6;
    }
    h1 { color: #222; }
    table, th, td {
      border: 1px solid #aaa;
      border-collapse: collapse;
      padding: 6px;
    }
    table { width: 100%; margin-top: 10px; }
    th { background-color: #f0f0f0; }
    input, select, button { margin: 5px; padding: 6px; }
    .section { margin-bottom: 40px; }
    .subaccount { padding-left: 20px; }
    .subtotal { font-weight: bold; }
    .modal-backdrop {
      position: fixed; top:0; left:0; width:100%; height:100%;
      background: rgba(0,0,0,0.4);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .modal {
      background: white; padding: 20px; border-radius: 6px;
      width: 300px; max-width: 90%;
      box-shadow: 0 0 10px #00000088;
    }
    .modal button { margin-top: 10px; }
  </style>
</head>
<body>
  <h1>General Ledger</h1>
  <nav>
    <a href="index.html">üè† Home</a>
    <a href="revenue-ledger.html">üìò Revenue Ledger</a>
    <a href="general-ledger.html">General Ledger</a>
  </nav>

  <div class="section">
    <h2>Add New Account</h2>
    <form id="addAccountForm">
      <input type="text" id="newAccountName" placeholder="Account Name" required>
      <select id="newAccountType" required>
        <option value="Asset">Asset</option>
        <option value="Liability">Liability</option>
        <option value="Equity">Equity</option>
        <option value="Revenue">Revenue</option>
        <option value="Expense">Expense</option>
      </select>
      <button type="submit">Add Account</button>
    </form>
  </div>

  <div class="section">
    <h2>New Journal Entry</h2>
    <form id="entryForm">
      <input type="date" id="date" required>
      <input type="text" id="description" placeholder="Description" required><br>
      <strong>Debit:</strong>
      <select id="debitAccount"></select>
      <input type="number" id="debitAmount" placeholder="Debit Amount" step="0.01" min="0"><br>
      <strong>Credit:</strong>
      <select id="creditAccount"></select>
      <input type="number" id="creditAmount" placeholder="Credit Amount" step="0.01" min="0"><br>
      <button type="submit">Post Entry</button>
    </form>
  </div>

  <div class="section">
    <h2>Journal Entries</h2>
    <table id="journal">
      <thead>
        <tr><th>Date</th><th>Description</th><th>Account</th><th>Debit</th><th>Credit</th></tr>
      </thead>
      <tbody></tbody>
    </table>
    <button id="clearJournalEntriesBtn">Clear All Journal Entries</button>
  </div>

  <div class="section">
    <h2>Balance Sheet</h2>
    <table id="balanceSheet">
      <thead><tr><th>Account</th><th>Type</th><th>Balance</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <div class="section">
    <h2>Income Statement</h2>
    <table id="incomeStatement">
      <thead><tr><th>Account</th><th>Balance</th></tr></thead>
      <tbody></tbody>
    </table>
    <p><strong>Net Income:</strong> <span id="netIncome">0.00</span></p>
    <label for="closeMonthSelect">Close to Month:</label>
    <input type="month" id="closeMonthSelect">
    <button id="closeMonth">Close Month</button>
  </div>

  <div class="section">
    <h2>Archived Journal Entries</h2>
    <select id="archivedJournalSelect">
      <option value="">-- Select Month --</option>
    </select>
    <table id="archivedJournalTable" style="display:none;">
      <thead>
        <tr><th>Date</th><th>Description</th><th>Account</th><th>Debit</th><th>Credit</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div class="section">
    <h2>Archived Income Statements</h2>
    <select id="archivedIncomeSelect">
      <option value="">-- Select Month --</option>
    </select>
    <table id="archivedIncomeTable" style="display:none;">
      <thead><tr><th>Account</th><th>Balance</th></tr></thead>
      <tbody></tbody>
      <tfoot>
        <tr><th>Net Income</th><th id="archivedNetIncome"></th></tr>
      </tfoot>
    </table>
  </div>

  <button id="hardResetBtn" style="margin-left: 20px; background:#d9534f; color:white;">Hard Reset (All Accounts & Balances)</button>

  <div id="modalBackdrop" class="modal-backdrop">
    <div class="modal">
      <p id="modalMessage"></p>
      <button id="modalConfirmBtn">Confirm</button>
      <button id="modalCancelBtn">Cancel</button>
    </div>
  </div>

  <script>
    let accounts = JSON.parse(localStorage.getItem('accounts')) || [];
    let journal = JSON.parse(localStorage.getItem('journal')) || [];

    const updateLocalStorage = () => {
      localStorage.setItem('accounts', JSON.stringify(accounts));
      localStorage.setItem('journal', JSON.stringify(journal));
    };

    const updateDropdowns = () => {
      const debitSel = document.getElementById('debitAccount');
      const creditSel = document.getElementById('creditAccount');
      debitSel.innerHTML = creditSel.innerHTML = '';
      accounts.forEach(a => {
        debitSel.innerHTML += `<option value="${a.name}">${a.name}</option>`;
        creditSel.innerHTML += `<option value="${a.name}">${a.name}</option>`;
      });
    };

    const renderJournal = () => {
      const tbody = document.getElementById('journal').querySelector('tbody');
      tbody.innerHTML = '';
      journal.forEach(entry => {
        const { date, description, debit, credit, amount } = entry;
        tbody.innerHTML += `
          <tr><td>${date}</td><td>${description}</td><td>${debit}</td><td>${amount}</td><td></td></tr>
          <tr><td>${date}</td><td>${description}</td><td>${credit}</td><td></td><td>${amount}</td></tr>
        `;
      });
    };

    const renderBalanceSheet = () => {
      const tbody = document.getElementById('balanceSheet').querySelector('tbody');
      tbody.innerHTML = '';
      accounts.forEach(account => {
        tbody.innerHTML += `
          <tr>
            <td>${account.name}</td>
            <td>${account.type}</td>
            <td>${account.balance.toFixed(2)}</td>
          </tr>
        `;
      });
    };

    const renderIncomeStatement = () => {
      const tbody = document.getElementById('incomeStatement').querySelector('tbody');
      tbody.innerHTML = '';
      let revenueTotal = 0;
      let expenseTotal = 0;
      accounts.forEach(a => {
        if (a.type === 'Revenue' || a.type === 'Expense') {
          let val = a.balance;
          if (a.type === 'Revenue') {
            val = -Math.abs(val); // Show revenue as negative
            revenueTotal += val;
          } else {
            expenseTotal += val;
          }
          tbody.innerHTML += `<tr><td>${a.name}</td><td>${val.toFixed(2)}</td></tr>`;
        }
      });
      const net = revenueTotal + expenseTotal;
      document.getElementById('netIncome').innerText = net.toFixed(2);
    };

    const saveArchive = (month) => {
      const archiveJournal = journal.filter(e => e.date.startsWith(month));
      localStorage.setItem(`journal_${month}`, JSON.stringify(archiveJournal));

      const incomeData = accounts.filter(a => ['Revenue', 'Expense'].includes(a.type));
      localStorage.setItem(`income_${month}`, JSON.stringify(incomeData));
    };

    const renderArchivedLists = () => {
      const journalSel = document.getElementById('archivedJournalSelect');
      const incomeSel = document.getElementById('archivedIncomeSelect');
      const keys = Object.keys(localStorage);
      const months = [...new Set(keys.filter(k => k.startsWith('journal_')).map(k => k.replace('journal_', '')))];
      journalSel.innerHTML = '<option value="">-- Select Month --</option>';
      incomeSel.innerHTML = '<option value="">-- Select Month --</option>';
      months.forEach(month => {
        journalSel.innerHTML += `<option value="${month}">${month}</option>`;
        incomeSel.innerHTML += `<option value="${month}">${month}</option>`;
      });
    };

    document.getElementById('addAccountForm').addEventListener('submit', e => {
      e.preventDefault();
      const name = document.getElementById('newAccountName').value;
      const type = document.getElementById('newAccountType').value;
      accounts.push({ name, type, balance: 0 });
      updateLocalStorage();
      updateDropdowns();
      renderBalanceSheet();
    });

    document.getElementById('entryForm').addEventListener('submit', e => {
      e.preventDefault();
      const date = document.getElementById('date').value;
      const description = document.getElementById('description').value;
      const debit = document.getElementById('debitAccount').value;
      const credit = document.getElementById('creditAccount').value;
      const amount = parseFloat(document.getElementById('debitAmount').value || 0);
      if (!date || !description || !debit || !credit || isNaN(amount)) return;

      journal.push({ date, description, debit, credit, amount });
      accounts.find(a => a.name === debit).balance += amount;
      accounts.find(a => a.name === credit).balance -= amount;

      updateLocalStorage();
      renderJournal();
      renderBalanceSheet();
      renderIncomeStatement();
    });

    document.getElementById('clearJournalEntriesBtn').addEventListener('click', () => {
      journal = [];
      accounts.forEach(a => a.balance = 0);
      updateLocalStorage();
      renderJournal();
      renderBalanceSheet();
      renderIncomeStatement();
    });

    document.getElementById('closeMonth').addEventListener('click', () => {
      const month = document.getElementById('closeMonthSelect').value;
      if (!month) return alert('Select a month');
      const revenue = accounts.filter(a => a.type === 'Revenue').reduce((acc, a) => acc - Math.abs(a.balance), 0);
      const expenses = accounts.filter(a => a.type === 'Expense').reduce((acc, a) => acc + a.balance, 0);
      const net = revenue + expenses;
      const retained = accounts.find(a => a.name === 'Retained Earnings');
      if (!retained) {
        accounts.push({ name: 'Retained Earnings', type: 'Equity', balance: net });
      } else {
        retained.balance += net;
      }
      saveArchive(month);
      accounts.forEach(a => {
        if (a.type === 'Revenue' || a.type === 'Expense') a.balance = 0;
      });
      updateLocalStorage();
      renderBalanceSheet();
      renderIncomeStatement();
      renderArchivedLists();
    });

    document.getElementById('archivedJournalSelect').addEventListener('change', function() {
      const month = this.value;
      const table = document.getElementById('archivedJournalTable');
      const tbody = table.querySelector('tbody');
      tbody.innerHTML = '';
      if (!month) return table.style.display = 'none';
      const data = JSON.parse(localStorage.getItem(`journal_${month}`) || '[]');
      data.forEach(entry => {
        tbody.innerHTML += `
          <tr><td>${entry.date}</td><td>${entry.description}</td><td>${entry.debit}</td><td>${entry.amount}</td><td></td></tr>
          <tr><td>${entry.date}</td><td>${entry.description}</td><td>${entry.credit}</td><td></td><td>${entry.amount}</td></tr>
        `;
      });
      table.style.display = '';
    });

    document.getElementById('archivedIncomeSelect').addEventListener('change', function() {
      const month = this.value;
      const table = document.getElementById('archivedIncomeTable');
      const tbody = table.querySelector('tbody');
      tbody.innerHTML = '';
      if (!month) return table.style.display = 'none';
      const data = JSON.parse(localStorage.getItem(`income_${month}`) || '[]');
      let net = 0;
      data.forEach(a => {
        let val = a.balance;
        if (a.type === 'Revenue') val = -Math.abs(val);
        else net += val;
        net += val;
        tbody.innerHTML += `<tr><td>${a.name}</td><td>${val.toFixed(2)}</td></tr>`;
      });
      document.getElementById('archivedNetIncome').innerText = net.toFixed(2);
      table.style.display = '';
    });

    const showModal = (message, onConfirm) => {
      document.getElementById('modalMessage').innerText = message;
      document.getElementById('modalBackdrop').style.display = 'flex';
      document.getElementById('modalConfirmBtn').onclick = () => {
        document.getElementById('modalBackdrop').style.display = 'none';
        onConfirm();
      };
      document.getElementById('modalCancelBtn').onclick = () => {
        document.getElementById('modalBackdrop').style.display = 'none';
      };
    };

    document.getElementById('hardResetBtn').addEventListener('click', () => {
      showModal('This will delete all data. Continue?', () => {
        localStorage.clear();
        location.reload();
      });
    });

    updateDropdowns();
    renderJournal();
    renderBalanceSheet();
    renderIncomeStatement();
    renderArchivedLists();
  </script>
</body>
</html>

