<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Cash Activity Summary</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 30px; }
    h1 { margin-bottom: 10px; }
    table, th, td {
      border: 1px solid #999;
      border-collapse: collapse;
      padding: 8px;
    }
    table { width: 100%; margin-top: 20px; }
    th { background-color: #f4f4f4; }
    select, input[type="text"], button {
      padding: 6px 10px;
      margin: 10px 5px 10px 0;
    }
  </style>
</head>
<body>

<h1>Cash Activity Summary</h1>
<a href="index.html">Home</a><br><br>

<label for="monthSelect">Select Month:</label>
<select id="monthSelect"></select>

<label for="typeFilter">Type:</label>
<select id="typeFilter">
  <option value="all">All</option>
  <option value="receipt">Cash Receipt</option>
  <option value="disbursement">Cash Disbursement</option>
</select>

<label for="descriptionFilter">Description:</label>
<input type="text" id="descriptionFilter" placeholder="Search...">

<table id="cashTable" style="display:none;">
  <thead>
    <tr>
      <th>Date</th>
      <th>Description</th>
      <th>Type</th>
      <th>Counter Account</th>
      <th>Amount</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
(function () {
  const journal = JSON.parse(localStorage.getItem("ledger_journal")) || [];

  function pad(n) {
    return n < 10 ? "0" + n : n;
  }

  function getMonthKey(dateStr) {
    const d = new Date(dateStr);
    return isNaN(d) ? "" : `${d.getFullYear()}-${pad(d.getMonth() + 1)}`;
  }

  function loadMonthOptions() {
    const select = document.getElementById("monthSelect");
    const months = new Set();
    journal.forEach(entry => {
      months.add(getMonthKey(entry.date));
    });
    const sorted = Array.from(months).sort().reverse();
    sorted.forEach(m => {
      const opt = new Option(m, m);
      select.appendChild(opt);
    });
  }

  function renderCashTable(monthKey) {
    const tbody = document.querySelector("#cashTable tbody");
    const table = document.getElementById("cashTable");
    tbody.innerHTML = "";

    const typeFilter = document.getElementById("typeFilter").value;
    const descFilter = document.getElementById("descriptionFilter").value.toLowerCase();

    const filtered = journal.filter(entry => {
      const entryMonth = getMonthKey(entry.date);
      const involvesCash =
        entry.debit.account === "Cash" || entry.credit.account === "Cash";
      const matchesMonth = entryMonth === monthKey;
      const matchesDesc = entry.description.toLowerCase().includes(descFilter);
      let matchesType = true;
      if (typeFilter === "receipt") matchesType = entry.debit.account === "Cash";
      if (typeFilter === "disbursement") matchesType = entry.credit.account === "Cash";
      return matchesMonth && involvesCash && matchesDesc && matchesType;
    });

    if (!filtered.length) {
      table.style.display = "none";
      return;
    }

    filtered.forEach(entry => {
      const isReceipt = entry.debit.account === "Cash";
      const type = isReceipt ? "Cash Receipt" : "Cash Disbursement";
      const counter = isReceipt ? entry.credit.account : entry.debit.account;
      const amount = (isReceipt ? entry.debit.amount : -entry.credit.amount).toFixed(2);

      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${entry.date}</td>
        <td>${entry.description}</td>
        <td>${type}</td>
        <td>${counter}</td>
        <td style="text-align:right;">${amount}</td>
      `;
      tbody.appendChild(row);
    });

    table.style.display = "";
  }

  document.getElementById("monthSelect").addEventListener("change", e => {
    renderCashTable(e.target.value);
  });

  document.getElementById("typeFilter").addEventListener("change", () => {
    renderCashTable(document.getElementById("monthSelect").value);
  });

  document.getElementById("descriptionFilter").addEventListener("input", () => {
    renderCashTable(document.getElementById("monthSelect").value);
  });

  loadMonthOptions();
})();
</script>

</body>
</html>

